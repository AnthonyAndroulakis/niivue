---
title: Synchronizing Multiple Views
sidebar_position: 4
---

import { Niivue } from '@niivue/niivue';
import { SyncDemo } from '../src/components/SyncDemo';
import { NiivueBrowserWrapper } from '../src/components/NiivueBrowserWrapper';

When working with medical imaging data, it's often useful to have multiple synchronized views of the same or different volumes. Niivue provides robust synchronization capabilities that allow you to coordinate navigation, interaction, and visualization across multiple viewers.

**Try interacting with the viewers below!** Use the dropdown to control which aspects are synchronized between the instances.

<NiivueBrowserWrapper>
  <SyncDemo />
</NiivueBrowserWrapper>

## Creating Multiple Niivue Instances

To synchronize views, you first need to create multiple Niivue instances, each attached to its own canvas element.

```javascript
// Create and initialize first Niivue instance
const nv1 = new Niivue();
await nv1.attachToCanvas(document.getElementById('canvas1'));
await nv1.loadVolumes([{ url: '/path/to/volume.nii.gz' }]);

// Create and initialize second Niivue instance
const nv2 = new Niivue();
await nv2.attachToCanvas(document.getElementById('canvas2'));
await nv2.loadVolumes([{ url: '/path/to/volume.nii.gz' }]);
```

## Setting Up Synchronization with broadcastTo

Niivue provides a powerful `broadcastTo` method that lets you create synchronized connections between multiple viewers. This allows you to easily synchronize camera movements, crosshair positions, and more.

```javascript
// Set up bidirectional synchronization between nv1 and nv2
// Synchronize both 2D (slices) and 3D (volume rendering) views
nv1.broadcastTo([nv2], { "2d": true, "3d": true });
nv2.broadcastTo([nv1], { "2d": true, "3d": true });
```

The `broadcastTo` method takes two parameters:
1. An array of Niivue instances to broadcast to
2. A configuration object that specifies what to synchronize:
   - `"2d"`: When true, synchronizes 2D slice views (crosshair position, pan, zoom)
   - `"3d"`: When true, synchronizes 3D volume rendering views (camera position)

## Synchronization Options

You can control which aspects of the views are synchronized:

```javascript
// Synchronize only 2D views (slices)
nv1.broadcastTo([nv2], { "2d": true, "3d": false });

// Synchronize only 3D views (volume rendering)
nv1.broadcastTo([nv2], { "2d": false, "3d": true });

// Disable synchronization
nv1.broadcastTo([nv2], { "2d": false, "3d": false });
```

## Synchronizing Multiple Viewers

You can synchronize more than two viewers by including all target instances in the array:

```javascript
// Create three Niivue instances
const nv1 = new Niivue();
const nv2 = new Niivue();
const nv3 = new Niivue();

// Attach to canvases and load volumes
// ...

// Set up synchronization between all three viewers
nv1.broadcastTo([nv2, nv3], { "2d": true, "3d": true });
nv2.broadcastTo([nv1, nv3], { "2d": true, "3d": true });
nv3.broadcastTo([nv1, nv2], { "2d": true, "3d": true });
```

## Triggering Synchronization

When you change a setting in one viewer, the synchronization happens automatically for most interactions like panning, zooming, or moving the crosshair. For some other changes, you may need to explicitly call the `sync()` method:

```javascript
// Make a change to nv1 (e.g., changing gamma)
nv1.setGamma(1.5);

// Force synchronization to the other viewers
nv1.sync();
```

## Synchronizing Views with Different Data

You can synchronize views even when displaying different types of data, such as an anatomical MRI in one view and a functional overlay in another, as long as they share the same spatial coordinates.

```javascript
// Load an anatomical image in the first viewer
await nv1.loadVolumes([{
  url: '/path/to/anatomical.nii.gz',
  colormap: 'gray'
}]);

// Load anatomical + functional overlay in the second viewer
await nv2.loadVolumes([
  {
    url: '/path/to/anatomical.nii.gz',
    colormap: 'gray'
  },
  {
    url: '/path/to/functional.nii.gz',
    colormap: 'warm',
    opacity: 0.7
  }
]);

// Synchronize the viewers
nv1.broadcastTo([nv2], { "2d": true, "3d": true });
nv2.broadcastTo([nv1], { "2d": true, "3d": true });
```

## Changing Multiplanar Layout

When using synchronized views, you may want to coordinate the layout of multiple viewers:

```javascript
// Change the layout of both viewers
// 0: Auto, 1: Column, 2: Grid, 3: Row
nv1.setMultiplanarLayout(2); // Set to Grid layout
nv2.setMultiplanarLayout(2); // Set to Grid layout
```

## Practical Example: Comparing Images

A common use case for synchronized views is comparing different scans of the same subject:

```javascript
// Set up two Niivue instances
const nv1 = new Niivue({
  show3Dcrosshair: true,
  backColor: [1, 1, 1, 1], // White background
});
await nv1.attachToCanvas(document.getElementById('viewer1'));

const nv2 = new Niivue({
  show3Dcrosshair: true,
  backColor: [1, 1, 1, 1],
});
await nv2.attachToCanvas(document.getElementById('viewer2'));

// Load different scans
await nv1.loadVolumes([{ url: '/images/t1_scan.nii.gz' }]);
await nv2.loadVolumes([{ url: '/images/t2_scan.nii.gz' }]);

// Set up bidirectional synchronization
nv1.broadcastTo([nv2], { "2d": true, "3d": true });
nv2.broadcastTo([nv1], { "2d": true, "3d": true });
```

Synchronizing multiple Niivue instances gives you powerful ways to visualize and compare medical imaging data, enabling more effective analysis and interpretation. 